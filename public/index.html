<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alpha TTS - Ù†Ø³Ù„ Ø¬Ø¯ÛŒØ¯ ØªØ¨Ø¯ÛŒÙ„ Ù…ØªÙ† Ø¨Ù‡ ØµØ¯Ø§</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap');
        :root {
            --app-font: 'Vazirmatn', sans-serif; --app-bg: #F8F9FC; --panel-bg: #FFFFFF;
            --panel-border: #EAEFF7; --input-bg: #F6F8FB; --input-border: #E1E7EF;
            --text-primary: #1A202C; --text-secondary: #626F86; --text-tertiary: #8A94A6;
            --accent-primary: #4A6CFA; --accent-primary-hover: #3553D6; --accent-primary-glow: rgba(74, 108, 250, 0.25);
            --accent-secondary: #0FD4A8; --accent-secondary-hover: #0DA986; --accent-secondary-glow: rgba(15, 212, 168, 0.2);
            --accent-premium: #FFC107; --accent-premium-glow: rgba(255, 193, 7, 0.3);
            --waveform-color-active: var(--accent-primary); --waveform-color-inactive: #D0D9E6; --waveform-dashed-line-color: #E0E4E9;
            --shadow-sm: 0 1px 2px 0 rgba(26, 32, 44, 0.03); --shadow-md: 0 4px 6px -1px rgba(26, 32, 44, 0.05), 0 2px 4px -2px rgba(26, 32, 44, 0.04);
            --shadow-lg: 0 10px 15px -3px rgba(26, 32, 44, 0.06), 0 4px 6px -4px rgba(26, 32, 44, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(26, 32, 44, 0.07), 0 8px 10px -6px rgba(26, 32, 44, 0.05);
            --radius-card: 24px; --radius-btn: 14px; --radius-input: 12px;
            --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-smooth: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes modalZoomIn { from { opacity: 0; transform: scale(0.9) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes rotate-loader-orbital { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes orbit-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--app-font); direction: rtl; background-color: var(--app-bg);
            color: var(--text-primary); font-size: 16px; line-height: 1.8; margin: 0;
            padding: 2.5rem 0; min-height: 100vh;
            display: flex; justify-content: center;
            align-items: flex-start; overflow-x: hidden;
            background-image: radial-gradient(var(--text-tertiary) 0.5px, transparent 0.5px);
            background-size: 20px 20px; background-position: -10px -10px;
        }
        .app-container { max-width: 820px; width: 92%; margin: 0 auto; }
        .app-header { padding: 0.5rem 0 2.5rem 0; text-align: center; margin-bottom: 1.5rem; animation: fadeIn 0.8s 0.2s ease-out backwards; }
        .app-header h1 { font-size: 2.5em; font-weight: 900; margin: 0 0 0.8rem 0; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -1px; }
        .app-header p { font-size: 1.05em; color: var(--text-secondary); margin-top: 0; opacity: 0.9; font-weight: 400; line-height: 1.7; }
        .main-content { position:relative; padding: 3rem; background-color: var(--panel-bg); border-radius: var(--radius-card); box-shadow: var(--shadow-xl); border: 1px solid var(--panel-border); animation: fadeIn 0.8s 0.4s ease-out backwards; }
        .form-group { margin-bottom: 2.2rem; }
        label { display: block; font-weight: 700; color: var(--text-primary); font-size: 1.1em; margin-bottom: 1rem; }
        textarea, input[type="text"] { width: 100%; padding: 1rem 1.2rem; border-radius: var(--radius-input); border: 1px solid var(--input-border); background-color: var(--input-bg); color: var(--text-primary); box-shadow: var(--shadow-sm) inset; font-family: var(--app-font); font-size: 1rem; box-sizing: border-box; transition: var(--transition-smooth); }
        textarea:focus, input[type="text"]:focus { outline: none; border-color: var(--accent-primary); box-shadow: 0 0 0 3px var(--accent-primary-glow), var(--shadow-sm) inset; background-color: var(--panel-bg); }
        textarea { min-height: 120px; resize: vertical; }
        .slider-container { display: flex; align-items: center; gap: 1.5rem; }
        input[type="range"] { flex-grow: 1; -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: var(--input-border); border-radius: 3px; outline: none; cursor: pointer; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 24px; height: 24px; background: #fff; border-radius: 50%; cursor: pointer; border: 4px solid var(--accent-primary); box-shadow: var(--shadow-md); margin-top: -9px; transition: var(--transition-fast); }
        .temperature-value { font-weight: 700; background-color: var(--input-bg); padding: 0.5rem 1rem; border-radius: 8px; border: 1px solid var(--input-border); min-width: 45px; text-align: center; color: var(--accent-primary); font-size: 1em; box-shadow: var(--shadow-sm); }
        .generate-btn { display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; padding: 1.1rem 1.5rem; font-size: 1.25em; font-weight: 800; background: linear-gradient(95deg, var(--accent-secondary) 0%, var(--accent-primary) 100%); color: #fff; border: none; border-radius: var(--radius-btn); cursor: pointer; transition: all 0.3s ease; box-shadow: 0 6px 12px -3px var(--accent-primary-glow), 0 6px 12px -3px var(--accent-secondary-glow); position: relative; overflow: hidden; letter-spacing: 0.5px; }
        .generate-btn:hover:not(:disabled) { transform: translateY(-5px) scale(1.02); box-shadow: 0 8px 20px -4px var(--accent-primary-glow), 0 8px 20px -4px var(--accent-secondary-glow); }
        .generate-btn:disabled { background: var(--text-tertiary); cursor: not-allowed; box-shadow: none; color: var(--text-secondary); }
        .generate-btn .spinner { width: 20px; height: 20px; border: 3px solid rgba(255, 255, 255, 0.4); border-top-color: #fff; border-radius: 50%; animation: spin 0.8s linear infinite; display: none;}
        .output-section { margin-top: 3rem; display: flex; align-items: center; justify-content: center; flex-direction: column; min-height: 220px; position: relative; box-sizing: border-box; padding: 2rem; background-color: var(--input-bg); border-radius: var(--radius-card); border: 2px dashed var(--input-border); box-shadow: var(--shadow-sm) inset; transition: var(--transition-smooth); }
        .output-section.has-content { background-color: var(--panel-bg); border: 1px solid var(--panel-border); box-shadow: var(--shadow-lg); padding: 0; min-height: auto; }
        .status-message { font-weight: 500; color: var(--text-secondary); text-align: center; font-size: 1.1em; }
        .status-message.error { color: #c53030; font-weight: 600; line-height: 1.9; }
        .loading-animation-wrapper { display: none; flex-direction: column; align-items: center; justify-content: center; gap: 1.8rem; width: 100%; }
        .orbital-loader { width: 110px; height: 110px; position: relative; animation: rotate-loader-orbital 10s linear infinite; }
        .orbit { position: absolute; top: 50%; left: 50%; border: 2px dashed rgba(74, 108, 250, 0.35); border-radius: 50%; transform-origin: center center; }
        .orbit:nth-child(1) { width: 35px; height: 35px; margin: -17.5px 0 0 -17.5px; animation: orbit-spin 2.8s linear infinite reverse; }
        .orbit:nth-child(2) { width: 65px; height: 65px; margin: -32.5px 0 0 -32.5px; animation: orbit-spin 3.8s linear infinite; }
        .orbit:nth-child(3) { width: 95px; height: 95px; margin: -47.5px 0 0 -47.5px; animation: orbit-spin 4.8s linear infinite reverse; }
        .loading-text { font-size: 1.2em; font-weight: 700; color: var(--text-primary); text-align: center; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .audio-player-content { display: none; width: 100%; padding: 1.5rem; box-sizing: border-box; flex-direction: column; gap: 1.2rem; animation: fadeIn 0.5s ease-out; }
        .audio-waveform-container { display: flex; align-items: center; gap: 1rem; width: 100%; margin-bottom: 1rem; }
        .audio-time { font-size: 0.9em; color: var(--text-secondary); min-width: 40px; text-align: center; font-variant-numeric: tabular-nums; user-select: none; }
        .audio-waveform { flex-grow: 1; height: 60px; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; margin-bottom: 0.5rem; }
        .audio-waveform-canvas { display: block; max-width: 100%; height: 100%; }
        .audio-waveform-dashed-line { position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background-image: linear-gradient(to right, var(--waveform-dashed-line-color) 33%, transparent 0%); background-position: center; background-size: 10px 1px; z-index: 1; }
        .audio-controls-group { display: flex; justify-content: center; align-items: center; gap: 1.5rem; margin-bottom: 1rem; }
        .audio-skip-btn, .audio-play-pause-btn-large, .audio-volume-btn { background: none; border: none; cursor: pointer; padding: 8px; transition: transform 0.2s, opacity 0.2s; color: var(--text-secondary); }
        .audio-skip-btn:hover, .audio-play-pause-btn-large:hover, .audio-volume-btn:hover { color: var(--accent-primary); opacity: 0.9; }
        .audio-play-pause-btn-large svg { width: 38px; height: 38px; fill: currentColor; }
        .audio-utility-controls { display: flex; align-items: center; justify-content: space-between; width: 100%; }
        .audio-volume-btn svg { width: 24px; height: 24px; fill: currentColor; }
        .audio-speed-btn { font-family: var(--app-font); font-size: 0.9em; font-weight: 600; background-color: var(--panel-bg); border: 1px solid var(--panel-border); border-radius: 8px; min-width: 40px; text-align: center; color: var(--text-primary); box-shadow: var(--shadow-sm); }
        #standard-view #selected-speaker-card { display: inline-flex; align-items: center; background: linear-gradient(135deg, var(--input-bg) 0%, var(--panel-bg) 100%); border-radius: 50px; padding: 0.75rem 0.75rem 0.75rem 1.5rem; box-shadow: var(--shadow-md); border: 1px solid var(--panel-border); transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); cursor: pointer; margin-bottom: 1.5rem; }
        #standard-view #selected-speaker-card:hover { transform: translateY(-6px) scale(1.03); box-shadow: var(--shadow-lg); border-color: var(--accent-primary); }
        #standard-view #selected-speaker-card img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-left: 1rem; border: 3px solid var(--accent-secondary); box-shadow: 0 0 15px -3px var(--accent-secondary-glow); }
        #standard-view #selected-speaker-info h3 { margin: 0; font-size: 1.25em; font-weight: 800; }
        #standard-view #selected-speaker-info p { margin: 2px 0 0; color: var(--text-secondary); font-size: 0.85em; font-weight: 500; }
        #standard-view #change-speaker-btn { display: inline-flex; align-items: center; justify-content: center; padding: 12px 24px; border-radius: var(--radius-btn); background: var(--panel-bg); border: 1px solid var(--input-border); color: var(--text-primary); cursor: pointer; font-family: var(--app-font); font-weight: 600; font-size: 1em; transition: var(--transition-smooth); box-shadow: var(--shadow-md); }
        #standard-view #change-speaker-btn:hover { background: var(--input-bg); border-color: var(--accent-primary); color: var(--accent-primary); transform: translateY(-3px) scale(1.05); box-shadow: var(--shadow-lg); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(18, 24, 38, 0.6); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 1000; opacity: 0; transition: opacity var(--transition-smooth); }
        .modal-overlay.visible { display: flex; opacity: 1; }
        .modal-dialog { background: var(--panel-bg); padding: 2.5rem; border-radius: var(--radius-card); width: 90%; box-shadow: var(--shadow-xl); border: 1px solid var(--panel-border); animation: modalZoomIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards; position: relative; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--panel-border); }
        .modal-header h2 { margin: 0; font-size: 1.8em; font-weight: 800; color: var(--accent-primary); }
        .close-modal-btn { background: none; border: none; font-size: 2.5rem; cursor: pointer; color: var(--text-tertiary); transition: var(--transition-smooth); line-height: 1; }
        .close-modal-btn:hover { color: var(--accent-primary); transform: rotate(90deg) scale(1.1); }
        #speaker-modal .modal-dialog { max-width: 750px; max-height: 85vh; overflow-y: auto; }
        #speaker-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 1.5rem; }
        .speaker-card { cursor: pointer; transition: var(--transition-smooth); text-align: center; position: relative; border-radius: var(--radius-card); padding: 0.5rem; }
        .speaker-card:hover { transform: translateY(-8px); }
        .speaker-card input[type="radio"] { display: none; }
        .speaker-card .speaker-visual { border: 3px solid transparent; border-radius: 18px; overflow: hidden; box-shadow: var(--shadow-md); position: relative; background-color: var(--input-bg); transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .speaker-card:hover .speaker-visual { box-shadow: var(--shadow-lg); }
        .speaker-card img { width: 100%; height: 130px; object-fit: cover; display: block; background-color: #e0e0e0; border-radius: 14px; transition: transform 0.4s; }
        .speaker-card:hover img { transform: scale(1.1); }
        .speaker-card .speaker-name { padding: 0.8rem 0.4rem 0.2rem; font-weight: 600; font-size: 0.95em; color: var(--text-secondary); }
        .speaker-card input[type="radio"]:checked + .speaker-visual { border-color: var(--accent-secondary); box-shadow: 0 0 25px -5px var(--accent-secondary-glow); transform: scale(1.05); }
        #credit-status-message { text-align: center; color: var(--text-secondary); font-weight: 600; margin-top: -1.5rem; opacity: 0; transform: translateY(10px); transition: opacity 0.4s ease, transform 0.4s ease; height: 0; overflow: hidden; }
        #credit-status-message.visible { opacity: 1; transform: translateY(0); height: auto; margin-bottom: 1.5rem; }
        #upgrade-premium-btn { display: none; width: 100%; margin-top: 1rem; padding: 1rem; font-family: var(--app-font); font-size: 1.1em; font-weight: 800; color: #212529; background: linear-gradient(95deg, #FFD54F, var(--accent-premium) 100%); border: none; border-radius: var(--radius-btn); cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 8px 20px -5px var(--accent-premium-glow); }
        #upgrade-premium-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 25px -5px rgba(255, 193, 7, 0.4); }
    </style>
</head>
<body>
    <div class="app-container">
        <div id="standard-view">
            <header class="app-header">
                <h1>Ù…ÙˆÙ„Ø¯ ØµØ¯Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¢Ù„ÙØ§</h1>
                <p>Ú©ÛŒÙÛŒØª Ø§Ø³ØªÙˆØ¯ÛŒÙˆØŒ Ù‚Ø¯Ø±Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ. ØµØ¯Ø§ÛŒÛŒ ÙØ±Ø§ØªØ± Ø§Ø² Ø§Ù†ØªØ¸Ø§Ø± Ø®Ù„Ù‚ Ú©Ù†ÛŒØ¯.</p>
            </header>
            <main class="main-content">
                <form id="standard-tts-form" onsubmit="return false;">
                    <div class="form-group">
                        <label for="text-input-standard">ğŸ“ Ù…ØªÙ† Ø§ØµÙ„ÛŒ</label>
                        <textarea id="text-input-standard" rows="5" placeholder="Ù…ØªÙ† Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ú¯ÙØªØ§Ø± Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="prompt-input-standard">ğŸ—£ï¸ ØªÙˆØµÛŒÙ Ù„Ø­Ù† Ùˆ Ø§Ø­Ø³Ø§Ø³ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                        <input type="text" id="prompt-input-standard" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ø§ Ù„Ø­Ù†ÛŒ Ø¢Ø±Ø§Ù… Ùˆ Ù‚ØµÙ‡â€ŒÚ¯Ùˆ">
                    </div>
                    <div class="form-group">
                        <label>ğŸ¤ Ú¯ÙˆÛŒÙ†Ø¯Ù‡ Ù…Ù†ØªØ®Ø¨</label>
                        <div id="selected-speaker-display" style="text-align: center;">
                            <div id="selected-speaker-card" title="Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ú¯ÙˆÛŒÙ†Ø¯Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯">
                                <img id="selected-speaker-img" src="" alt="Ø¹Ú©Ø³ Ú¯ÙˆÛŒÙ†Ø¯Ù‡">
                                <div id="selected-speaker-info">
                                    <h3 id="selected-speaker-name"></h3>
                                    <p id="selected-speaker-desc"></p>
                                </div>
                            </div>
                            <button type="button" id="change-speaker-btn">ØªØºÛŒÛŒØ± Ú¯ÙˆÛŒÙ†Ø¯Ù‡</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="temperature-slider-standard">ğŸŒ¡ï¸ Ø®Ù„Ø§Ù‚ÛŒØª Ùˆ Ù¾ÙˆÛŒØ§ÛŒÛŒ ØµØ¯Ø§</label>
                        <div class="slider-container">
                            <input type="range" id="temperature-slider-standard" class="temperature-slider" min="0.1" max="1.5" step="0.05" value="0.9">
                            <span id="temperature-value-standard" class="temperature-value">0.9</span>
                        </div>
                    </div>
                    <p id="credit-status-message"></p>
                    <button type="submit" id="generate-btn-standard" class="generate-btn">
                        <span class="btn-text">âœ¨ Ø®Ù„Ù‚ ØµØ¯Ø§ Ø¨Ø§ Ø¢Ù„ÙØ§</span>
                        <div class="spinner"></div>
                    </button>
                    <button type="button" id="upgrade-premium-btn">â­ï¸ Ø§Ø±ØªÙ‚Ø§ Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„ Ùˆ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯</button>
                </form>
                <div id="output-section-standard" class="output-section">
                    <div id="status-message-standard" class="status-message">ØµØ¯Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¸Ø§Ù‡Ø± Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.</div>
                    <div id="loading-animation-wrapper-standard" class="loading-animation-wrapper">
                         <div class="orbital-loader"><div class="orbit"></div><div class="orbit"></div><div class="orbit"></div></div>
                         <p class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡ÙˆØ´Ù…Ù†Ø¯...</p>
                    </div>
                    <div id="audio-player-content-standard" class="audio-player-content"></div>
                </div>
            </main>
        </div>
        <audio id="hidden-audio-player" style="display: none;"></audio>
        <div id="speaker-modal" class="modal-overlay">
            <div class="modal-dialog">
                <div class="modal-header">
                    <h2>Ú¯Ø§Ù„Ø±ÛŒ Ú¯ÙˆÛŒÙ†Ø¯Ú¯Ø§Ù† Ø¢Ù„ÙØ§</h2>
                    <button type="button" class="close-modal-btn">Ã—</button>
                </div>
                <div id="speaker-grid"></div>
            </div>
        </div>
        <input type="hidden" id="selected_speaker_id_storage" value="Charon">
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const speakers = [ { id: "Charon", name: "Ø´Ù‡Ø§Ø¨ (Ù…Ø±Ø¯)", desc: "ØµØ¯Ø§ÛŒÛŒ Ù‚Ø¯Ø±ØªÙ…Ù†Ø¯ Ùˆ Ø±Ø³Ø§", imgUrl: "https://uploadkon.ir/uploads/a18705_25IMG-Û²Û°Û²ÛµÛ°Û·Û°Ûµ-Û±Û±Û°ÛµÛ´Û¹.jpg" }, { id: "Zephyr", name: "Ø¢ÙˆØ§ (Ø²Ù†)", desc: "Ù„Ø·ÛŒÙ Ùˆ Ø¯Ù„Ù†Ø´ÛŒÙ†", imgUrl: "https://uploadkon.ir/uploads/029605_25IMG-Û²Û°Û²ÛµÛ°Û·Û°Ûµ-Û±Û±Û±Û²ÛµÛ².jpg" }, { id: "Achird", name: "Ù†ÙˆÛŒØ¯ (Ù…Ø±Ø¯)", desc: "Ø¬ÙˆØ§Ù† Ùˆ Ù¾Ø±Ø§Ù†Ø±Ú˜ÛŒ", imgUrl: "https://uploadkon.ir/uploads/697e05_25IMG-Û²Û°Û²ÛµÛ°Û¶Û°Û¹-Û°Û¶Û´Û¶Û³Û·.jpg" }, { id: "Zubenelgenubi", name: "Ø¢Ø±Ù…Ø§Ù† (Ù…Ø±Ø¯)", desc: "Ú¯Ø±Ù… Ùˆ ØµÙ…ÛŒÙ…ÛŒ", imgUrl: "https://uploadkon.ir/uploads/a8a705_25IMG-Û²Û°Û²ÛµÛ°Û·Û°Ûµ-Û±Û±Û±Û¶Û²Û¹.jpg" }, { id: "Vindemiatrix", name: "Ù…Ù‡Ø³Ø§ (Ø²Ù†)", desc: "Ø¨Ø§ÙˆÙ‚Ø§Ø± Ùˆ Ø±Ø³Ù…ÛŒ", imgUrl: "https://uploadkon.ir/uploads/d74d05_25IMG-Û²Û°Û²ÛµÛ°Û·Û°Ûµ-Û±Û±Û±Û¸Û³Û¸.jpg" }, { id: "Sadachbia", name: "Ø³Ø§Ù…Ø§Ù† (Ù…Ø±Ø¯)", desc: "Ø´Ø§Ø¯Ø§Ø¨ Ùˆ Ù¾ÙˆÛŒØ§", imgUrl: "https://uploadkon.ir/uploads/580205_25IMG-Û²Û°Û²ÛµÛ°Û·Û°Ûµ-Û±Û±Û³Û³Û³Û°.jpg" }];
        let userSubscriptionStatus = 'free';
        let userFingerprint = null;
        let audioContext, audioPeaks = [], currentPlaybackSpeedIndex = 0;
        const playbackSpeeds = [1.0, 1.25, 1.5, 0.75];
        
        const standardView = document.getElementById('standard-view');
        const generateBtn = document.getElementById('generate-btn-standard');
        const creditStatusMessage = document.getElementById('credit-status-message');
        const upgradeBtn = document.getElementById('upgrade-premium-btn');
        const mainAudioPlayer = document.getElementById('hidden-audio-player');
        const speakerModal = document.getElementById('speaker-modal');
        const speakerGridInModal = document.getElementById('speaker-grid');
        const selectedSpeakerIdStorage = document.getElementById('selected_speaker_id_storage');
        const changeSpeakerBtn = document.getElementById('change-speaker-btn');
        const selectedSpeakerCard = document.getElementById('selected-speaker-card');
        const selectedSpeakerImg = document.getElementById('selected-speaker-img');
        const selectedSpeakerName = document.getElementById('selected-speaker-name');
        const selectedSpeakerDesc = document.getElementById('selected-speaker-desc');

        async function getBrowserFingerprint() {
            const components = [navigator.userAgent, navigator.language, screen.width + 'x' + screen.height, new Date().getTimezoneOffset()];
            try {
                const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                ctx.textBaseline = "top"; ctx.font = "14px 'Arial'"; ctx.textBaseline = "alphabetic"; ctx.fillStyle = "#f60"; ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = "#069"; ctx.fillText("a1b2c3d4e5f6g7h8i9j0_!@#$%^&*()", 2, 15);
                components.push(canvas.toDataURL());
            } catch (e) { components.push("canvas-error"); }
            const fingerprintString = components.join('~~~');
            let hash = 0;
            for (let i = 0; i < fingerprintString.length; i++) {
                const char = fingerprintString.charCodeAt(i); hash = ((hash << 5) - hash) + char; hash |= 0;
            }
            return 'fp_' + Math.abs(hash).toString(16);
        }

        async function updateUIWithServerStatus() {
            if (!userFingerprint) return;

            creditStatusMessage.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±...';
            creditStatusMessage.classList.add('visible');

            if (userSubscriptionStatus === 'paid') {
                creditStatusMessage.textContent = 'Ø´Ù…Ø§ Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±ÛŒØ¯.';
                generateBtn.disabled = false;
                upgradeBtn.style.display = 'none';
                return;
            }

            try {
                const response = await fetch('/api/check-credit-tts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ fingerprint: userFingerprint, subscriptionStatus: userSubscriptionStatus })
                });

                if (!response.ok) throw new Error('Server response was not ok.');
                const result = await response.json();

                if (result.limit_reached) {
                    generateBtn.disabled = true;
                    upgradeBtn.style.display = 'block';
                    creditStatusMessage.textContent = 'Ø§Ø¹ØªØ¨Ø§Ø± Ø±Ø§ÛŒÚ¯Ø§Ù† Ø±ÙˆØ²Ø§Ù†Ù‡ Ø´Ù…Ø§ ØªÙ…Ø§Ù… Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯ØŒ Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±ØªÙ‚Ø§ Ø¯Ù‡ÛŒØ¯.';
                } else {
                    generateBtn.disabled = false;
                    upgradeBtn.style.display = 'none';
                    creditStatusMessage.textContent = `Ø´Ù…Ø§ ${result.credits_remaining} Ø§Ø¹ØªØ¨Ø§Ø± Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¨Ø±Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ø¯Ø§Ø±ÛŒØ¯.`;
                }
            } catch (error) {
                console.error("Credit check failed:", error);
                creditStatusMessage.textContent = "Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±. Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.";
                generateBtn.disabled = true;
            }
        }
        
        function updateUIForSubscriptionStatus(status) {
            userSubscriptionStatus = status;
            updateUIWithServerStatus();
        }
        
        function isUserPaid(userObject) {
            const PREMIUM_PAGE_ID = 'YOUR_PREMIUM_PAGE_ID'; // Ø´Ù†Ø§Ø³Ù‡ ØµÙØ­Ù‡ Ù¾ÙˆÙ„ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯
            return userObject && userObject.isLogin && userObject.accessible_pages && (userObject.accessible_pages.includes(PREMIUM_PAGE_ID) || userObject.accessible_pages.includes(parseInt(PREMIUM_PAGE_ID)));
        }

        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'USER_STATUS_RESPONSE') {
                if (event.data.error || !event.data.payload) {
                    updateUIForSubscriptionStatus('free');
                    return;
                }
                try {
                    const userObject = JSON.parse(event.data.payload);
                    const status = isUserPaid(userObject) ? 'paid' : 'free';
                    updateUIForSubscriptionStatus(status);
                } catch (e) {
                    updateUIForSubscriptionStatus('free');
                }
            }
        });

        upgradeBtn.addEventListener('click', () => {
            const PREMIUM_URL = '#/YOUR/PREMIUM/URL'; // URL ØµÙØ­Ù‡ Ø®Ø±ÛŒØ¯ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯
            parent.postMessage({ type: 'NAVIGATE_TO_PREMIUM', payload: { url: PREMIUM_URL } }, '*');
        });

        standardView.querySelector('#standard-tts-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const btnText = generateBtn.querySelector('.btn-text');
            const btnSpinner = generateBtn.querySelector('.spinner');
            const statusMessage = document.getElementById('status-message-standard');
            const playerContent = document.getElementById('audio-player-content-standard');
            const outputSection = document.getElementById('output-section-standard');
            const loadingAnimation = document.getElementById('loading-animation-wrapper-standard');

            generateBtn.disabled = true;
            btnSpinner.style.display = 'inline-block';
            btnText.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...';
            playerContent.style.display = 'none';
            statusMessage.style.display = 'none';
            outputSection.classList.remove('has-content');
            loadingAnimation.style.display = 'flex';
            mainAudioPlayer.src = '';
            audioPeaks = [];

            try {
                const textInput = document.getElementById('text-input-standard').value;
                const promptInput = document.getElementById('prompt-input-standard').value;
                const tempSlider = document.getElementById('temperature-slider-standard').value;
                const speakerId = selectedSpeakerIdStorage.value;

                if (!textInput.trim()) {
                    throw new Error('Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.');
                }
                
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: textInput,
                        prompt: promptInput,
                        speaker: speakerId,
                        temperature: parseFloat(tempSlider),
                        fingerprint: userFingerprint,
                        subscriptionStatus: userSubscriptionStatus
                    })
                });

                if (response.status === 429) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || "Ø§Ø¹ØªØ¨Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡ Ø´Ù…Ø§ ØªÙ…Ø§Ù… Ø´Ø¯Ù‡ Ø§Ø³Øª.");
                }

                if (!response.ok) {
                    throw new Error(await response.text() || `Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ± (${response.status})`);
                }
                
                mainAudioPlayer.src = URL.createObjectURL(await response.blob());
                loadingAnimation.style.display = 'none';
                
            } catch (error) {
                loadingAnimation.style.display = 'none';
                statusMessage.textContent = `Ø®Ø·Ø§: ${error.message}`;
                statusMessage.style.display = 'block';
                statusMessage.classList.add('error');
                updateUIWithServerStatus();
            } finally {
                btnSpinner.style.display = 'none';
                btnText.textContent = 'âœ¨ Ø®Ù„Ù‚ ØµØ¯Ø§ Ø¨Ø§ Ø¢Ù„ÙØ§';
                if(userSubscriptionStatus === 'free') {
                    await updateUIWithServerStatus();
                } else {
                    generateBtn.disabled = false;
                }
            }
        });

        const updateSelectedSpeakerDisplay = (speakerId) => {
            const speaker = speakers.find(s => s.id === speakerId) || speakers[0];
            selectedSpeakerImg.src = speaker.imgUrl;
            selectedSpeakerName.textContent = speaker.name;
            selectedSpeakerDesc.textContent = speaker.desc;
            selectedSpeakerIdStorage.value = speaker.id;
        };

        const createSpeakerCardsInModal = () => {
            speakerGridInModal.innerHTML = '';
            speakers.forEach((speaker) => {
                const card = document.createElement('label');
                card.className = 'speaker-card';
                card.innerHTML = `<input type="radio" name="modal_speaker_selection" value="${speaker.id}" ${speaker.id === selectedSpeakerIdStorage.value ? 'checked' : ''}><div class="speaker-visual"><img src="${speaker.imgUrl}" alt="${speaker.name}" loading="lazy"></div><div class="speaker-name">${speaker.name}</div>`;
                card.addEventListener('click', () => {
                    updateSelectedSpeakerDisplay(speaker.id);
                    speakerModal.classList.remove('visible');
                });
                speakerGridInModal.appendChild(card);
            });
        };

        [changeSpeakerBtn, selectedSpeakerCard].forEach(el => el.addEventListener('click', () => {
            createSpeakerCardsInModal();
            speakerModal.classList.add('visible');
        }));
        speakerModal.addEventListener('click', (e) => (e.target === speakerModal) && speakerModal.classList.remove('visible'));
        speakerModal.querySelector('.close-modal-btn').addEventListener('click', () => speakerModal.classList.remove('visible'));
        
        function createPlayerInstance(containerId) {
            const playerContent = document.getElementById(containerId);
            playerContent.innerHTML = `<div class="audio-waveform-container"><span class="audio-time audio-current-time">0:00</span><div class="audio-waveform"><canvas class="audio-waveform-canvas"></canvas><div class="audio-waveform-dashed-line"></div></div><span class="audio-time audio-total-time">0:00</span></div><div class="audio-controls-group"><button type="button" class="audio-skip-btn backward" title="Ù¾Ø±Ø´ Ø¨Ù‡ Ø¹Ù‚Ø¨"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 16V8l-4 4 4 4zm4-12v16l7-8-7-8z"></path></svg></button><button type="button" class="audio-play-pause-btn-large"><svg viewBox="0 0 24 24" class="play-icon"><path d="M8 5v14l11-7z"></path></svg><svg viewBox="0 0 24 24" class="pause-icon" style="display:none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg></button><button type="button" class="audio-skip-btn forward" title="Ù¾Ø±Ø´ Ø¨Ù‡ Ø¬Ù„Ùˆ"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 16V8l4 4-4 4zM9 4v16L2 12l7-8z"></path></svg></button></div><div class="audio-utility-controls"><button type="button" class="audio-volume-btn" title="Ù‚Ø·Ø¹/ÙˆØµÙ„ ØµØ¯Ø§"><svg viewBox="0 0 24 24" class="volume-high-icon"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg><svg viewBox="0 0 24 24" class="volume-mute-icon" style="display:none;"><path d="M7 9v6h4l5 5V4L11 9H7zM16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zM19 12c0 .94-.23 1.82-.68 2.6L19 14.88c.45-.88.7-1.88.7-2.88 0-4.01-2.99-7.14-7-8.05v2.06c2.89.86 5 3.54 5 6.71zM4.55 4L2 6.55 9.45 14H7v6h4l5 5V14.55l4.05 4.05L22 18 12 8 4.55 4z"></path></svg></button><button type="button" class="audio-speed-btn" title="Ø³Ø±Ø¹Øª Ù¾Ø®Ø´">1x</button></div>`;
            playerContent.querySelector('.audio-play-pause-btn-large').addEventListener('click', () => mainAudioPlayer.paused ? mainAudioPlayer.play() : mainAudioPlayer.pause());
            playerContent.querySelector('.audio-skip-btn.backward').addEventListener('click', () => mainAudioPlayer.currentTime = Math.max(0, mainAudioPlayer.currentTime - 5));
            playerContent.querySelector('.audio-skip-btn.forward').addEventListener('click', () => mainAudioPlayer.currentTime = Math.min(mainAudioPlayer.duration, mainAudioPlayer.currentTime + 5));
            const volBtn = playerContent.querySelector('.audio-volume-btn'); volBtn.addEventListener('click', () => { mainAudioPlayer.muted = !mainAudioPlayer.muted; volBtn.querySelector('.volume-high-icon').style.display = mainAudioPlayer.muted ? 'none' : 'block'; volBtn.querySelector('.volume-mute-icon').style.display = mainAudioPlayer.muted ? 'block' : 'none'; });
            const speedBtn = playerContent.querySelector('.audio-speed-btn'); speedBtn.addEventListener('click', () => { currentPlaybackSpeedIndex = (currentPlaybackSpeedIndex + 1) % playbackSpeeds.length; mainAudioPlayer.playbackRate = playbackSpeeds[currentPlaybackSpeedIndex]; speedBtn.textContent = `${playbackSpeeds[currentPlaybackSpeedIndex]}x`; });
        }
        
        const formatTime = (s) => { if (isNaN(s) || s < 0) return '0:00'; const m = Math.floor(s / 60); return `${m}:${Math.floor(s % 60).toString().padStart(2, '0')}`; };
        
        const processAudioForWaveform = async (url) => {
            audioPeaks = []; if(!url) return; if(!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
            try {
                const response = await fetch(url);
                const arrayBuffer = await response.arrayBuffer();
                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                const data = audioBuffer.getChannelData(0);
                const samples = Math.floor(audioBuffer.duration * 40);
                if(samples === 0) { audioPeaks = []; return; }
                const peaks = []; const sampleSize = Math.floor(data.length / samples);
                for (let i = 0; i < samples; i++) {
                    let max = 0; const start = i * sampleSize;
                    for (let j = 0; j < sampleSize; j++) { const val = Math.abs(data[start + j]); if (val > max) max = val; }
                    peaks.push(Math.min(1, Math.max(0, max * 1.5)));
                }
                audioPeaks = peaks;
            } catch(e) { console.error("Error processing waveform:", e); audioPeaks = []; }
        };

        const drawWaveform = (canvas, progressRatio) => {
            if (!canvas || !audioPeaks.length) return;
            const waveformCtx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1; 
            canvas.width = canvas.offsetWidth * dpr; canvas.height = canvas.offsetHeight * dpr; 
            waveformCtx.scale(dpr, dpr);
            const width = canvas.offsetWidth; const height = canvas.offsetHeight;
            waveformCtx.clearRect(0, 0, width, height);
            const barWidth = 3; const barGap = 2; const totalBarWidth = barWidth + barGap;
            const numBars = Math.floor(width / totalBarWidth); const offset = (width - numBars * totalBarWidth) / 2;
            const inactiveColor = getComputedStyle(document.documentElement).getPropertyValue('--waveform-color-inactive').trim();
            const activeColor = getComputedStyle(document.documentElement).getPropertyValue('--waveform-color-active').trim();
            
            waveformCtx.fillStyle = inactiveColor;
            for (let i = 0; i < numBars; i++) {
                const peakIndex = Math.floor((i / numBars) * audioPeaks.length);
                const barHeight = (audioPeaks[peakIndex] || 0) * height;
                const x = offset + i * totalBarWidth; const y = (height - barHeight) / 2;
                waveformCtx.fillRect(x, y, barWidth, barHeight);
            }
            const activeFillEnd = progressRatio * width;
            if (activeFillEnd > 0) {
                waveformCtx.fillStyle = activeColor;
                 for (let i = 0; i < numBars; i++) {
                    const x = offset + i * totalBarWidth;
                    if (x + barWidth > activeFillEnd) break;
                    const peakIndex = Math.floor((i / numBars) * audioPeaks.length);
                    const barHeight = (audioPeaks[peakIndex] || 0) * height;
                    const y = (height - barHeight) / 2;
                    waveformCtx.fillRect(x, y, barWidth, barHeight);
                }
            }
        };

        const updatePlayerUI = () => {
            const playerContent = document.getElementById('audio-player-content-standard');
            const isPlaying = !(mainAudioPlayer.paused || mainAudioPlayer.ended);
            playerContent.querySelector('.play-icon').style.display = isPlaying ? 'none' : 'block';
            playerContent.querySelector('.pause-icon').style.display = isPlaying ? 'block' : 'none';
            const { currentTime, duration } = mainAudioPlayer;
            playerContent.querySelector('.audio-current-time').textContent = formatTime(currentTime);
            playerContent.querySelector('.audio-total-time').textContent = isFinite(duration) ? formatTime(duration) : '0:00';
            const activeCanvas = playerContent.querySelector('.audio-waveform-canvas');
            if (activeCanvas) {
                 const progressRatio = isFinite(duration) && duration > 0 ? currentTime / duration : 0;
                 requestAnimationFrame(() => drawWaveform(activeCanvas, progressRatio));
            }
        };

        mainAudioPlayer.addEventListener('loadedmetadata', async () => {
            const outputSection = document.getElementById('output-section-standard');
            const playerContent = document.getElementById('audio-player-content-standard');
            await processAudioForWaveform(mainAudioPlayer.src);
            outputSection.classList.add('has-content');
            playerContent.style.display = 'flex';
            updatePlayerUI();
        });
        ['timeupdate', 'play', 'pause', 'ended'].forEach(e => mainAudioPlayer.addEventListener(e, updatePlayerUI));
        window.addEventListener('resize', updatePlayerUI);
        document.getElementById('temperature-slider-standard').addEventListener('input', (e) => {
            document.getElementById('temperature-value-standard').textContent = e.target.value;
        });
        
        async function initializeApp() {
            userFingerprint = await getBrowserFingerprint();
            parent.postMessage({ type: 'REQUEST_USER_STATUS' }, '*');
            createPlayerInstance('audio-player-content-standard');
            updateSelectedSpeakerDisplay(selectedSpeakerIdStorage.value);
        }

        initializeApp();
    });
    </script>
</body>
</html>
